package it.unibz.pomodroid.factories;

import it.unibz.pomodroid.persistency.Activity;
import it.unibz.pomodroid.persistency.DBHelper;


import java.util.Date;
import java.util.HashMap;
import java.util.Vector;
import it.unibz.pomodroid.exceptions.PomodroidException;

/**
 * 
 * @author Thomas Schievenin
 * 
 *         A class that saves all information about tickets it into the
 *         database. Each ticket taken from TRAC is checked. If some information
 *         are empty, the class provides some auto-generated values.
 * 
 */
public class ActivityFactory {

	/**
	 * @param id
	 *            trac identifier
	 * @param deadLine
	 *            date within the work has be done
	 * @param attributes
	 *            list containing all information about one ticket
	 * @param dbHelper
	 *            reference to the database
	 */
	public static int produce(Vector<HashMap<String, Object>> tickets,
			DBHelper dbHelper) throws PomodroidException {
		int ticketsNumber = 0;
		final String autogen = "Autogenerated value";
		for (HashMap<String, Object> ticket : tickets) {

			if (isEmpty(ticket.get("summary").toString()))
				ticket.put("summary", autogen);
			if (isEmpty(ticket.get("description").toString()))
				ticket.put("description", autogen);
			if (isEmpty(ticket.get("priority").toString()))
				ticket.put("priority", autogen);
			if (isEmpty(ticket.get("reporter").toString()))
				ticket.put("priority", autogen);
			if (isEmpty(ticket.get("type").toString()))
				ticket.put("priority", autogen);

			Activity activity = new Activity(0, new Date(), (Date) ticket
					.get("deadLine"), ticket.get("summary").toString(), ticket
					.get("description").toString(), ticket.get("origin")
					.toString(), (Integer) ticket.get("originId"), ticket.get(
					"priority").toString(), ticket.get("reporter").toString(),
					ticket.get("type").toString());

			if (!Activity.isPresent(activity.getOrigin(), activity
					.getOriginId(), dbHelper)) {
				activity.save(dbHelper);
				ticketsNumber++;
			}

		}

		return ticketsNumber;
	}
	
	/**
	 * @param id
	 *            trac identifier
	 * @param deadLine
	 *            date within the work has be done
	 * @param attributes
	 *            list containing all information about one ticket
	 * @param dbHelper
	 *            reference to the database
	 */
	public static int produceTest(Vector<HashMap<String, Object>> tickets,
			DBHelper dbHelper) throws PomodroidException {
		int ticketsNumber = 0;
		final String autogen = "Autogenerated value";
		for (HashMap<String, Object> ticket : tickets) {

			if (isEmpty(ticket.get("summary").toString()))
				ticket.put("summary", autogen);
			if (isEmpty(ticket.get("description").toString()))
				ticket.put("description", autogen);
			if (isEmpty(ticket.get("priority").toString()))
				ticket.put("priority", autogen);
			if (isEmpty(ticket.get("reporter").toString()))
				ticket.put("priority", autogen);
			if (isEmpty(ticket.get("type").toString()))
				ticket.put("priority", autogen);

			Activity activity = new Activity(0, new Date(), (Date) ticket
					.get("deadLine"), ticket.get("summary").toString(), ticket
					.get("description").toString(), ticket.get("origin")
					.toString(), (Integer) ticket.get("originId"), ticket.get(
					"priority").toString(), ticket.get("reporter").toString(),
					ticket.get("type").toString());

			if (!Activity.isPresent(activity.getOrigin(), activity
					.getOriginId(), dbHelper)) {
				ticketsNumber++;
			}

		}

		return ticketsNumber;
	}

	private static boolean isEmpty(String string) throws PomodroidException {
		return (string.equals("") || string.equals(null));
	}

}
